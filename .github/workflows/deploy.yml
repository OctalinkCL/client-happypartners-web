name: Despliegue de Astro a cPanel (al fusionar a main)

# Este workflow se dispara cuando se hace un 'push' (una fusi칩n, commit directo, etc.)
# a la rama 'main'.
on:
    push:
        branches:
            - main

jobs:
    build_and_deploy:
        runs-on: ubuntu-latest

        steps:
            # 1. Checkout del c칩digo
            - name: Checkout del repositorio
              uses: actions/checkout@v4

            # 2. Configuraci칩n de Node.js (Astro requiere al menos Node 18)
            - name: Configurar Node.js 18
              uses: actions/setup-node@v4
              with:
                  node-version: "18"
                  cache: "npm"

            # 3. Instalaci칩n de dependencias
            - name: Instalar dependencias
              # Usamos 'npm ci' para instalaciones limpias y reproducibles en CI/CD
              run: npm ci

            # 4. Construcci칩n del proyecto Astro
            - name: Construir proyecto Astro
              # Asume que 'npm run build' compila tu sitio est치tico a la carpeta 'dist/'
              run: npm run build
              # Nota: Ya no necesitamos pasar variables de entorno de Firebase aqu칤.

            # 5. Despliegue v칤a FTP
            - name: 游 Sincronizar y Desplegar archivos por FTP
              # Usamos la acci칩n SamKirkland/FTP-Deploy-Action, la m치s com칰n para este fin.
              uses: SamKirkland/FTP-Deploy-Action@v4.3.5
              with:
                  # Servidor FTP: Es m치s seguro usar un Secret para esto tambi칠n.
                  server: ${{ secrets.FTP_SERVER }}

                  # Credenciales: OBLIGATORIO usar Secrets para mantener la seguridad.
                  username: ${{ secrets.FTP_USERNAME }}
                  password: ${{ secrets.FTP_PASSWORD }}

                  # Ruta de origen (donde Astro deja los archivos est치ticos)
                  local-dir: "./dist/"

                  # Ruta de destino en el cPanel (ajusta si es diferente a tu public_html)
                  # NOTA: Se ha cambiado a "" (ra칤z) como sugeriste en tu 칰ltimo snippet,
                  # pero aseg칰rate de que esta es la ruta correcta para tu hosting.
                  server-dir: ""

                  # Opcional pero recomendado: forzar SSL/TLS para la conexi칩n FTP
                  # ftp-ssl: true

                  # Opcional (춰usar con precauci칩n!): Elimina archivos en el servidor que no est치n en 'dist'
                  # dangerous-clean-slate: true
